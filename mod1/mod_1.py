from flask import Flask

# utility modules
from random import choice
from datetime import datetime, timedelta
import os.path
import re


# creating an application instance
app = Flask(__name__)


# task 1
# -----------------------------------------------
#                                               |
# Что нужно сделать:                            |
# Создайте страницу с текстом «Привет, мир!».   |
#                                               |
# -----------------------------------------------

@app.route('/hello_world')
def first_page():
    return "Привет, мир!"


# task 2
# -----------------------------------------------------------------
#                                                                 |
# Что нужно сделать:                                              |
# - Создайте страницу, возвращающую список машин через запятую:   |
#   Chevrolet, Renault, Ford, Lada.                               |
#                                                                 |
# Что оценивается:                                                |
# - Список машин не пересоздаётся при открытии страницы.          |
#                                                                 |
# -----------------------------------------------------------------

# list of cars for the "/cars" page
car_list = [
    'Chevrolet',
    'Renault',
    'Ford',
    'Lada',
]


@app.route('/cars')
def second_page():
    return ', '.join(car_list)


# task 3
# --------------------------------------------------------------------------------
#                                                                                |
# Что нужно сделать:                                                             |
# - Создайте страницу с названием случайной породы кошек из следующего списка:   |
#   корниш-рекс, русская голубая, шотландская вислоухая, мейн-кун, манчкин.      |
#                                                                                |
# Что оценивается:                                                               |
# - Список машин не пересоздаётся при открытии страницы.                         |
# - При обновлении страницы каждый раз выводится случайная порода.               |
#                                                                                |
# --------------------------------------------------------------------------------

# list of cats for the "/cats" page
cat_list = [
    'корниш-рекс',
    'русская голубая',
    'шотландская вислоухая',
    'мейн-кун',
    'манчкин'
]


@app.route('/cats')
def third_page():
    return choice(cat_list)


# task 4
# ------------------------------------------------------------------------
#                                                                        |
# Что нужно сделать:                                                     |
# - Создайте страницу с текстом «Точное время: {current_time}»,          |
#   где current_time — точное текущее время.                             |
#                                                                        |
# Что оценивается:                                                       |
# - При форматировании строк используются переменные, а не выражения.    |
# - При обновлении страницы время также обновляется.                     |
#                                                                        |
# ------------------------------------------------------------------------

@app.route('/get_time/now')
def fourth_page():
    current_time = datetime.now().time()
    return f'Точное время: {current_time}'


# task 5
# -----------------------------------------------------------------------------------------
#                                                                                         |
# Что нужно сделать:                                                                      |
# - Создайте страницу с текстом «Точное время через час будет {current_time_after_hour}», |
#   где current_time_after_hour — точное                                                  |
#                                                                                         |
# Что оценивается:                                                                        |
# - При форматировании строк используются переменные, а не выражения.                     |
# - При обновлении страницы время также обновляется.                                      |
#                                                                                         |
# -----------------------------------------------------------------------------------------

@app.route('/get_time/future')
def fifth_page():
    current_datetime = datetime.now()
    current_datetime_after_hour = current_datetime + timedelta(hours=1)
    current_time_after_hour = current_datetime_after_hour.time()
    return f'Точное время через час будет: {current_time_after_hour}'


# task 6
# -----------------------------------------------------------------------------------------------------
#                                                                                                     |
# Что нужно сделать:                                                                                  |
# - Создайте страницу со случайным словом из книги «Война и мир» Льва Толстого.                       |
#   Книга лежит в одной папке с практическим заданием и называется war_and_peace.txt.                 |
#                                                                                                     |
# Что оценивается:                                                                                    |
# - Слово отображается без знаков препинания.                                                         |
# - Получение списка слов вынесено в отдельную функцию.                                               |
# - При запуске программы из другой директории и наличии файла war_and_peace.txt не выводится ошибка. |
# - При обращении к странице файл не открывается заново.                                              |
#                                                                                                     |
# -----------------------------------------------------------------------------------------------------

# absolute path to the project folder
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
# path to war_and_peace.txt file
BOOK_FILE = os.path.join(BASE_DIR, 'war_and_peace.txt')
# Creating a list of all the words of the book "War and peace"

with open(BOOK_FILE, encoding='utf-8') as book:
    text = book.read()
    # splitting text into words and removing numbers
    result = [
        word
        for word in re.findall(r'\w+', text)
        if not word.isdigit()
    ]


@app.route('/get_random_word')
def sixth_page():
    return choice(result)


# task 7
# -----------------------------------------------------------------------------------------
#                                                                                         |
# Что нужно сделать:                                                                      |
# - Создайте страницу с числом, показывающим, сколько раз открывалась данная страница.    |
#                                                                                         |
# Что оценивается:                                                                        |
# - Из декорируемой функции возвращается строка, а не число.                              |
# - При обновлении страницы счётчик должен увеличиваться.                                 |
#                                                                                         |
# -----------------------------------------------------------------------------------------

counter_visits = 0


@app.route('/counter')
def seventh_page():
    global counter_visits
    counter_visits = counter_visits + 1
    return str(counter_visits)


# run the application
if __name__ == '__main__':
    app.run(debug=True)
